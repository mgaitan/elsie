<!DOCTYPE html>
<html>
    <head>
        <title>La maquina de escribir de Elsie</title>

        <!-- Bootstrap -->
        <link href="css/jquery-ui.css" rel="stylesheet">
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <!-- keyboard widget css & script -->
        <link href="css/keyboard.css" rel="stylesheet">
    </head>
<body>

<div class="container">
      <div class="row-fluid"><p></p></div>

       <div class="row-fluid invisible">
            <textarea rows="6"  class="span12" id="keyboard"></textarea>
      </div>
</div>



<script src="js/jquery.js"></script>
<script src="js/jquery-ui-1.8.16.custom.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/jquery.keyboard.min.js"></script>
<script src="js/jquery.keyboard.extension-typing.js"></script>

<script>

$('#keyboard').keyboard({
     layout: 'custom',
     alwaysOpen: true,
     lockInput: true,
     restrictInput: true,
     customLayout: {

       'default' : [
            'A E I O U ',
            'B C D F G H J K L M N ',
            'A E I O U ',
            '\u00d1 P Q R S T V X Y Z',
            '{space}',

        ],

       // http://es.wikipedia.org/wiki/Frecuencia_de_aparici%C3%B3n_de_letras
       // E A O S R N I D L C T U M P B G V Y Q H F Z J Ã‘ X W K
        'prob': [
            '{bksp} {space}',
            'E A O I U',
            'S R N D L C T M P G',
            '{bksp} {space} ',
            'V Y Q H F Z J \u00d1 X W K',
             ' , . ? ! '
        ]
       },

     });



$(function() {


    var PAUSE = 2000;
    var IGNORE_TIME = 2000;

    var base = $('#keyboard').getkeyboard();
    var keys = base.$keyboard.find('button:visible');
    var o = base.options;

    base.ignore = false ;   // prevent multiple dispatch

    // unbind mouse on keyboard
    keys.off('mousedown.keyboard mouseenter.keyboard mouseleave.keyboard');

    base.specials = {
                'space': ' ',
                'bksp': 'bksp',
            }


    var rotate = function(actual, prev){
        if (prev)  prev.removeClass(o.css.buttonHover);
        actual.addClass(o.css.buttonHover);
        base.actual = actual;

        next_index = keys.index(actual) + 1;
        if (next_index > keys.length) {
            next_index = 0;
        }
        next = keys.eq(next_index);
        base.interval = setTimeout(function(){
                                    rotate(next, actual); },
                                PAUSE
                            );

    }

    var insert = function(e) {
                console.log( e.keyCode);
                if (e.keyCode === 8) {
                    base.insertText('bksp');
                    return;
                } else if( e.keyCode === 122 ){
                    // ignore F11
                    return ;
                }

                if (base.ignore) return;
                base.ignore = true;

                txt = base.actual.attr('name');
                k = (base.specials.hasOwnProperty(txt)) ? base.specials[txt] : base.actual.attr('data-value');
                base.insertText(k);
                keys.removeClass(o.css.buttonHover);
                clearInterval(base.interval);

                /* where to jump
                var row = parseInt( base.actual.attr('data-pos')[0]);
                if (row == 1) {
                    // jump to consonant
                    next = $('button[data-pos="2,0"]');
                } else if (row == 2 || row == 4) {
                    // jump to vowal
                    next = $('button[data-pos="1,0"]');
                } else {
                    next = $('button:first');
                } */

                rotate(keys.eq(0));

                // leave token after IGNORE_TIME
                setInterval(function(){
                             base.ignore = false;
                            }, IGNORE_TIME);


            };

    rotate($('button:first'));



    // bind click and keypress everywhere
    $('body').attr('style', 'height: 1024px');

    $('body').on('keypress click', insert);
    base.$keyboard.on('click', insert);
    keys.on('click', insert);

    // right click also trigger insert
    $('body').on('contextmenu', function(e){
        insert(e);
        return false;
    });


});

</script>
</body>
</html>
